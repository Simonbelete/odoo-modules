<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="external_layout">
        <div>
            <p t-field="data.company_id" />
        </div>
        <div>
            <h4 t-field="data.name" />
        </div>
    </template>

    <template id="report_production_products">
        <t t-set="data_report_landscape" t-value="False" />
        <t t-call="web.basic_layout">
            <t t-foreach="docs" t-as="data">
                <div class="page">
                    <div>
                        <h3 t-field="data.product_id.name" />
                        <p><span t-field="data.product_qty"/> (<span t-field="data.product_uom_id.name"/>) from 1 manufacturing order.</p>
                    </div>
                    <h5>Cost Structure</h5>
                    <table class="table table-sm" style="font-size: 14px" t-if="data.move_raw_ids">
                        <thead>
                            <tr style="border-width: 4px;
                                       border-top-style: groove;
                                       border-bottom-style: groove;
                                       padding: 1px">
                                <th>Product</th>
                                <th>BoM</th>
                                <th>Quantity</th>
                                <th>Unit Cost</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Total Raw Cost -->
                            <t t-set="raw_material_total_cost" t-value="0" />
                            <tr>
                                <td><span style="font-weight: bold;" t-field="data.product_id"/></td>
                                <td><span t-field="data.product_id"/></td>
                                <td><span t-field="data.product_qty"/> (<span t-field="data.product_uom_id.name"/>)</td>
                                <td><span></span></td>
                                <td><span></span></td>
                            </tr>
                            <t t-foreach="data.move_raw_ids" t-as="raw_line">
                                <t t-set="raw_material_total_cost" t-value="raw_material_total_cost + raw_line.total_cost"/>
                                <tr>
                                    <td colspan="2">
                                        <span style="margin-left: 20px">
                                            <span t-field="raw_line.product_id" />
                                        </span>
                                        <span>
                                            -
                                            <span t-field="raw_line.product_id.product_type"/>
                                            /
                                            <span t-field="raw_line.product_id.measurement_uom_id"/>
                                        </span>
                                    </td>
                                    <td><span t-field="raw_line.product_qty" /></td>
                                    <!-- <td><span t-field="raw_line.bom_line_id.product_qty" /></td> -->
                                    <td><span t-field="raw_line.cost_history" /></td>
                                    <td><span t-field="raw_line.total_cost" /></td>
                                </tr>
                            </t>
                            <tr>
                                <td></td>
                                <td></td>
                                <td><b>Total Cost of Raw Materials</b></td>
                                <td><span><t t-esc="raw_material_total_cost" /></span></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </template>
</odoo>